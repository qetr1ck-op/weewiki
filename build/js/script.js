function cSecurityManagerApp(e){function t(){for(var e=0;e<arguments.length;e++)arguments[e].onclick=function(){this.focus()}}function o(){var e=_$("#scrollControler");e&&!e.instance&&(v=new csc(e,!1,!0)),v.lockedClick=$ua.iP()||$ua.chrome(),v.refresh(),_$(".scrollBar",p).parentNode.style.top=TOOL_BAR_HEIGHT+"px",A.resizeScroll()}function n(){p.parentNode.style.height=window.innerHeight-TOOL_BAR_HEIGHT+"px",w.innerHTML="",h.value="",f.value="",h.placeholder=e.loc("login","security"),f.placeholder=e.loc("password","security"),$dom.hide(p),$dom.show(y),$dom.show(_$("#cflow ")),i(),e.initCases()}function i(){$dom.showed(p)||(appConfig.securityAccessAllowed?$dom.hide(e.cvSignInBtn):$dom.show(e.cvSignInBtn))}function s(){for(var t=0;t<arguments.length;t++)if(!arguments[t].value)return w.innerHTML=arguments[t]==h?w.innerHTML=e.loc("noLogin","security"):e.loc("noPassword","security"),$dom.show(w),A.resizeScroll(),r(_),!0;return!1}function r(e){e.classList.contains("shake")?(e.style.animationName="none",e.style.webkitAnimationName="none",setTimeout(function(){e.style.animationName="shake",e.style.webkitAnimationName="shake"},0)):e.classList.add("shake")}function a(e,t,o){A.getFromPortal($soap.createRequest("urn:Webservices"+F,e,t),e,o)}function c(e){var t,o=new XMLHttpRequest,n=lStorage.getItem("lastValidLogin")||h.value,i=lStorage.getItem("lastValidPassword")||f.value;return t=e.loginVar+"="+n+"&"+e.passVar+"=",t+="MD5"==e.passEncode?$crypt.hex_md5(i):"SHA1"==e.passEncode?$crypt.sha1(i,!1):i,o.onerror=function(){$log.info("remoteAuthentication"+o.status)},o.open(e.method,"POST"==e.method?e.url:e.url+"?"+t,!1),"POST"==e.method?(o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(t)):o.send(),+e.rot47?o.responseText==$crypt.rot47(e.positiveResponce):o.responseText==e.positiveResponce}function l(t,o){appConfig.securityAccessAllowed=!0,lStorage.setItem("securityAccessAllowed",!0),lStorage.setItem("lastValidLogin",h.value),lStorage.setItem("lastValidPassword",f.value),o?(o.suspended=!o.suspended,o.innerText=o.suspended?"Download":"Stop",e.mngDownloader[o.suspended?"stop":"start"](o.eMagName,!o.suspended)):isNaN(t)||e.coverFlowAction(t),$dom.hide(e.cvSignInBtn),n()}function d(t,o){return $dom.hide(w),s(h,f)?void 0:e.isConnected()?(w.innerHTML=e.loc("checkPleaseWait","security"),$dom.show(w),A.resizeScroll(),S?c(S)?l(t,o):(w.innerHTML=e.loc("checkFailed","security"),$dom.show(w),A.resizeScroll(),r(_)):a("checkPassword",{profile_id:$soap.createField("string",lStorage.getItem("profile_id")),login:$soap.createField("string",h.value),password:$soap.createField("string",f.value)},function(n){+$soap.getFieldValue(n,"exists")?l(t,o):(w.innerHTML=e.loc("checkFailed","security"),$dom.show(w),A.resizeScroll(),r(_))}),void 0):(e.showAlert("Connection problem!","Can't check security status, please connect to the Internet","OK"),n())}var p,u,g,m,$,h,f,w,y,v,_,S,A=new cSecurityManager({mb:{settings:{}}}),I=!1,F="PortalAccessProtection";return A.resizeScroll=function(e){for(;v.owner.offsetHeight<u.offsetHeight+($ua.iP()?200+($ua.iPad()?400:0):200);)v.refresh(),e&&v.setPosition([0,h.getBoundingClientRect().bottom])},A.load=function(){return e.content.parentNode.contains(p)?A.init():void _$get("main/tmpl/protection.htm",function(t){e.content.parentNode.insertAdjacentHTML("beforeEnd",t),p=_$("#protectionWrapper"),u=_$(".protectionWindow",p),g=_$(".protectionBackBar",p),m=_$(".button_back",g),_=_$(".protectionForm",p),$=_$(".protectionSubmit",u),h=_$("input[type=text]",u),f=_$("input[type=password]",u),w=_$(".protectionErrorMessage",u),cvMessageLabel=_$(".protectionMessage",u),y=_$("#tabsControl"),e.cvSignInBtn.firstChild.innerHTML=e.loc("signIn","security"),e.cvSignInBtn.onclick=function(){A.show(void 0)},A.init()})},A.init=function(){e.isConnected()?a("checkExistanceByApp",{app_id:$soap.createField("string",APP_ID)},function(t){return(I=+$soap.getFieldValue(t,"exists")?!0:!1)?(appConfig.securityAccessAllowed=!1,lStorage.setItem("message",$soap.getFieldValue(t,"message")),lStorage.setItem("profile_id",$soap.getFieldValue(t,"profile_id")),"remote"==$soap.getFieldValue(t,"auth_type")&&(S={url:"http://"+$soap.getFieldValue(t.config,"url"),method:$soap.getFieldValue(t.config,"method"),rot47:$soap.getFieldValue(t.config,"rot47"),loginVar:$soap.getFieldValue(t.config,"user_variable"),passVar:$soap.getFieldValue(t.config,"password_variable"),passEncode:$soap.getFieldValue(t.config,"password_encode"),positiveResponce:$soap.getFieldValue(t.config,"positive_response")}),void(lStorage.getItem("lastValidLogin")&&lStorage.getItem("lastValidPassword")?S?(c(S)&&(appConfig.securityAccessAllowed=!0),i()):a("checkPassword",{profile_id:$soap.createField("string",lStorage.getItem("profile_id")),login:$soap.createField("string",lStorage.getItem("lastValidLogin")),password:$soap.createField("string",lStorage.getItem("lastValidPassword"))},function(e){appConfig.securityAccessAllowed=+$soap.getFieldValue(e,"exists")?!0:!1,i()}):i())):(appConfig.securityAccessAllowed=!0,$dom.hide(e.cvSignInBtn))}):(appConfig.securityAccessAllowed=!1,e.showAlert(e.loc("connectionProblem","errors"),e.loc("securityStatus","errors"),"OK"),i())},A.show=function(i,s){_$("#wrapper").style.height=screen.availHeight+"px",$dom.show(p),$dom.hide(y),$dom.hide(e.cvSignInBtn),$.innerHTML=e.loc("submit","security"),m.innerHTML=e.loc("back","security"),h.placeholder=e.loc("login","security"),f.placeholder=e.loc("password","security"),cvMessageLabel.innerHTML=$crypt.b64decode(lStorage.getItem("message")),t(h,f),$dom.hide(_$("#cflow ")),o(),m.onclick=n,$.onclick=function(){d(i,s)}},A}var obj={},newObj={};